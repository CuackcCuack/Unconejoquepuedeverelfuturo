<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Samurai Defender</title>
	<style>
		canvas {
			border: 1px solid black;
		}
	</style>
</head>
<body>
	<h1>Samurai Defender</h1>
	<canvas id="gameCanvas" width="800" height="600"></canvas>
	<script>
		// Variables del juego
		var canvas;
		var canvasContext;
		var bunnyX = 400;
		var bunnyY = 300;
		var predatorX = 100;
		var predatorY = 100;
		var predatorShapes = [{type: "circle", x: 50, y: 50, radius: 20}, {type: "rectangle", x: 100, y: 100, width: 30, height: 30}];
		var shapesDrawn = [];

		// Función para dibujar el conejo
		function drawBunny() {
			canvasContext.fillStyle = "gray";
			canvasContext.beginPath();
			canvasContext.arc(bunnyX, bunnyY, 20, 0, Math.PI*2, true);
			canvasContext.fill();
		}

		// Función para dibujar los depredadores
		function drawPredators() {
			canvasContext.fillStyle = "orange";
			for (var i = 0; i < predatorShapes.length; i++) {
				var shape = predatorShapes[i];
				canvasContext.beginPath();
				if (shape.type === "circle") {
					canvasContext.arc(predatorX + shape.x, predatorY + shape.y, shape.radius, 0, Math.PI*2, true);
				} else if (shape.type === "rectangle") {
					canvasContext.fillRect(predatorX + shape.x, predatorY + shape.y, shape.width, shape.height);
				}
				canvasContext.fill();
			}
		}

		// Función para dibujar las formas que se hayan dibujado
		function drawShapes() {
			canvasContext.strokeStyle = "red";
			canvasContext.lineWidth = 3;
			for (var i = 0; i < shapesDrawn.length; i++) {
				var shape = shapesDrawn[i];
				canvasContext.beginPath();
				if (shape.type === "circle") {
					canvasContext.arc(shape.x, shape.y, shape.radius, 0, Math.PI*2, true);
				} else if (shape.type === "rectangle") {
					canvasContext.strokeRect(shape.x, shape.y, shape.width, shape.height);
				}
				canvasContext.stroke();
			}
		}

		// Función para actualizar la posición de los depredadores
		function updatePredatorPosition() {
			var predatorSpeed = 2;
			predatorX += predatorSpeed;
			if (predatorX > canvas.width) {
				predatorX = -50;
			}
		}

		// Función para comprobar si se ha dibujado una forma en un depredador
		function checkForShapeHit() {
			for (var i = 0; i < predatorShapes.length; i++) {
				var shape = predatorShapes[i];
				for (var j = 0; j < shapesDrawn.length; j++) {
					var drawnShape = shapesDrawn[j];
					if (shape.type === drawnShape.type) {
						if (shape.type === "circle") {
							var distance = Math.sqrt(Math.pow(predatorX + shape.x - drawnShape.x, 2) + Math.pow(predatorY + shape.y - drawnShape.y, 2));
                            if (distance < shape.radius) {
                                predatorShapes.splice(i, 1);
                                return;
                            }
                        } else if (shape.type === "rectangle") {
                        var xOverlap = Math.max(0, Math.min(predatorX + shape.x + shape.width, drawnShape.x + drawnShape.width) - Math.max(predatorX + shape.x, drawnShape.x));
                        var yOverlap = Math.max(0, Math.min(predatorY + shape.y + shape.height, drawnShape.y + drawnShape.height) - Math.max(predatorY + shape.y, drawnShape.y));
                        var overlapArea = xOverlap * yOverlap;
                            if (overlapArea > 0) {
                            predatorShapes.splice(i, 1);
                            return;
                            }
                        }          
                    }
                }
            }
        }
	// Función principal del juego
	function gameLoop() {
		canvasContext.clearRect(0, 0, canvas.width, canvas.height);
		drawBunny();
		drawPredators();
		drawShapes();
		updatePredatorPosition();
		checkForShapeHit();
		window.requestAnimationFrame(gameLoop);
	}

	// Función para empezar el juego
	window.onload = function() {
		canvas = document.getElementById("gameCanvas");
		canvasContext = canvas.getContext("2d");
		canvas.addEventListener("mousedown", function(event) {
			var shapeType = event.shiftKey ? "rectangle" : "circle";
			shapesDrawn.push({type: shapeType, x: event.offsetX, y: event.offsetY, radius: 20, width: 30, height: 30});
		});
		gameLoop();
	};
</script>
</body>
</html>

